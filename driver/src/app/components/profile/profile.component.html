<div class="profile-container">
  <!-- Authentication Section (when not logged in) -->
  <div *ngIf="!isLoggedIn" class="auth-section">
    <div class="auth-header">
      <h2>Driver Profile</h2>
      <p>Please login or register to access your profile</p>
    </div>

    <div class="auth-buttons" *ngIf="!showLoginForm && !showRegistrationForm">
      <button class="btn btn-primary" (click)="showLogin()">Login</button>
      <button class="btn btn-secondary" (click)="showRegistration()">Register</button>
    </div>

    <!-- Login Form -->
    <div *ngIf="showLoginForm" class="auth-form">
      <div class="form-header">
        <h3>Login</h3>
        <button class="close-btn" (click)="hideAuthForms()">&times;</button>
      </div>
      
      <form (ngSubmit)="login()">
        <div class="form-group">
          <label for="loginEmail">Email</label>
          <input 
            type="email" 
            id="loginEmail"
            [(ngModel)]="loginEmail"
            name="loginEmail"
            class="form-control"
            placeholder="Enter your email"
            required>
        </div>
        
        <div class="form-group">
          <label for="loginPassword">Password</label>
          <input 
            type="password" 
            id="loginPassword"
            [(ngModel)]="loginPassword"
            name="loginPassword"
            class="form-control"
            placeholder="Enter your password"
            required>
        </div>
        
        <div class="form-actions">
          <button 
            type="submit" 
            class="btn btn-primary"
            [disabled]="isLoading">
            <span *ngIf="isLoading" class="spinner"></span>
            {{ isLoading ? 'Logging in...' : 'Login' }}
          </button>
          <button type="button" class="btn btn-link" (click)="showRegistration()">
            Don't have an account? Register
          </button>
        </div>
      </form>
    </div>

    <!-- Registration Form -->
    <div *ngIf="showRegistrationForm" class="auth-form">
      <div class="form-header">
        <h3>Register</h3>
        <button class="close-btn" (click)="hideAuthForms()">&times;</button>
      </div>
      
      <form (ngSubmit)="register()">
        <div class="form-row">
          <div class="form-group">
            <label for="regName">Full Name *</label>
            <input 
              type="text" 
              id="regName"
              [(ngModel)]="registrationData.name"
              name="regName"
              class="form-control"
              placeholder="Enter your full name"
              required>
          </div>
          
          <div class="form-group">
            <label for="regEmail">Email *</label>
            <input 
              type="email" 
              id="regEmail"
              [(ngModel)]="registrationData.email"
              name="regEmail"
              class="form-control"
              placeholder="Enter your email"
              required>
          </div>
        </div>
        
        <div class="form-row">
          <div class="form-group">
            <label for="regPassword">Password *</label>
            <input 
              type="password" 
              id="regPassword"
              [(ngModel)]="registrationData.password"
              name="regPassword"
              class="form-control"
              placeholder="Enter your password"
              required>
          </div>
          
          <div class="form-group">
            <label for="regPhone">Phone *</label>
            <input 
              type="tel" 
              id="regPhone"
              [(ngModel)]="registrationData.phone"
              name="regPhone"
              class="form-control"
              placeholder="Enter your phone number"
              required>
          </div>
        </div>
        
        <div class="form-row">
          <div class="form-group">
            <label for="regVehicleType">Vehicle Type</label>
            <select 
              id="regVehicleType"
              [(ngModel)]="registrationData.vehicle_type"
              name="regVehicleType"
              class="form-control">
              <option value="">Select vehicle type</option>
              <option value="car">Car</option>
              <option value="motorcycle">Motorcycle</option>
              <option value="truck">Truck</option>
              <option value="van">Van</option>
            </select>
          </div>
          
          <div class="form-group">
            <label for="regVehicleNumber">Vehicle Number</label>
            <input 
              type="text" 
              id="regVehicleNumber"
              [(ngModel)]="registrationData.vehicle_number"
              name="regVehicleNumber"
              class="form-control"
              placeholder="Enter vehicle number">
          </div>
        </div>
        
        <div class="form-actions">
          <button 
            type="submit" 
            class="btn btn-primary"
            [disabled]="isLoading">
            <span *ngIf="isLoading" class="spinner"></span>
            {{ isLoading ? 'Registering...' : 'Register' }}
          </button>
          <button type="button" class="btn btn-link" (click)="showLogin()">
            Already have an account? Login
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- Profile Section (when logged in) -->
  <div *ngIf="isLoggedIn" class="profile-section">
    <div class="profile-header">
      <h2>Driver Profile</h2>
      <div class="header-actions">
        <!-- Debug buttons - remove in production -->
        <button class="btn btn-warning" (click)="testLoadProfile()">Test Load</button>
        <button class="btn btn-info" (click)="loadTestData()">Load Test Data</button>
        
        <button 
          *ngIf="!isEditing" 
          class="btn btn-primary" 
          (click)="toggleEdit()">
          Edit Profile
        </button>
        <button class="btn btn-danger" (click)="logout()">Logout</button>
      </div>
    </div>

    <div *ngIf="isLoading" class="loading-section">
      <div class="spinner-large"></div>
      <p>Loading profile...</p>
    </div>

    <div *ngIf="!isLoading" class="profile-content">
      <!-- Profile Picture Section -->
      <div class="profile-picture-section">
        <div class="picture-container">
          <div class="profile-picture" [class.uploading]="isUploading">
            <img 
              *ngIf="getProfilePictureUrl()"
              [src]="getProfilePictureUrl()" 
              alt="Profile Picture"
              style="width: 100%; height: 100%; object-fit: cover; border-radius: 50%;">
            
            <span *ngIf="!getProfilePictureUrl()" class="profile-initials">
              {{ getProfileInitials() }}
            </span>
          </div>
          
          <div *ngIf="isUploading" class="upload-overlay">
            <div class="spinner"></div>
            <p>Uploading...</p>
          </div>
        </div>
        
        <div class="picture-actions">
          <input 
            type="file" 
            #fileInput 
            (change)="onFileSelect($event)"
            accept="image/*"
            style="display: none;">
          
          <button 
            class="btn btn-secondary"
            (click)="fileInput.click()"
            [disabled]="isUploading">
            Choose Picture
          </button>
          
          <button 
            *ngIf="selectedFile"
            class="btn btn-primary"
            (click)="uploadProfilePicture()"
            [disabled]="isUploading">
            Upload
          </button>
          
          <button 
            *ngIf="driverProfile.profile_picture || driverProfile.profile_picture_url"
            class="btn btn-outline-danger"
            (click)="removeProfilePicture()"
            [disabled]="isUploading">
            Remove
          </button>
        </div>
      </div>

      <!-- Profile Information -->
      <div class="profile-info">
        <div class="info-section">
          <h3>Personal Information</h3>
          
          <div class="form-row">
            <div class="form-group">
              <label>Full Name</label>
              <input 
                type="text" 
                [(ngModel)]="driverProfile.name"
                class="form-control"
                [readonly]="!isEditing"
                [class.readonly]="!isEditing">
            </div>
            
            <div class="form-group">
              <label>Email</label>
              <input 
                type="email" 
                [(ngModel)]="driverProfile.email"
                class="form-control"
                [readonly]="!isEditing"
                [class.readonly]="!isEditing">
            </div>
          </div>
          
          <div class="form-row">
            <div class="form-group">
              <label>Phone</label>
              <input 
                type="tel" 
                [(ngModel)]="driverProfile.phone"
                class="form-control"
                [readonly]="!isEditing"
                [class.readonly]="!isEditing">
            </div>
            
            <div class="form-group">
              <label>Rating</label>
              <div class="rating-display">
                <span class="rating-value">{{ driverProfile.rating || 'N/A' }}</span>
                <div class="stars">
                  <i *ngFor="let star of [1,2,3,4,5]" 
                     class="fas fa-star"
                     [class.filled]="star <= (driverProfile.rating || 0)">
                  </i>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="info-section">
          <h3>Vehicle Information</h3>
          
          <div class="form-row">
            <div class="form-group">
              <label>Vehicle Type</label>
              <select 
                [(ngModel)]="driverProfile.vehicle_type"
                class="form-control"
                [disabled]="!isEditing">
                <option value="">Select vehicle type</option>
                <option value="car">Car</option>
                <option value="motorcycle">Motorcycle</option>
                <option value="truck">Truck</option>
                <option value="van">Van</option>
              </select>
            </div>
            
            <div class="form-group">
              <label>Vehicle Number</label>
              <input 
                type="text" 
                [(ngModel)]="driverProfile.vehicle_number"
                class="form-control"
                [readonly]="!isEditing"
                [class.readonly]="!isEditing">
            </div>
          </div>
          
          <div class="form-row">
            <div class="form-group">
              <label>Vehicle Model</label>
              <input 
                type="text" 
                [(ngModel)]="driverProfile.vehicle_model"
                class="form-control"
                [readonly]="!isEditing"
                [class.readonly]="!isEditing"
                placeholder="Enter vehicle model">
            </div>
            
            <div class="form-group">
              <label>License Plate</label>
              <input 
                type="text" 
                [(ngModel)]="driverProfile.license_plate"
                class="form-control"
                [readonly]="!isEditing"
                [class.readonly]="!isEditing"
                placeholder="Enter license plate">
            </div>
          </div>
        </div>

        <div class="info-section">
          <h3>Payment Information</h3>
          
          <div class="form-row">
            <div class="form-group">
              <label>Account Name</label>
              <input 
                type="text" 
                [(ngModel)]="driverProfile.account_name"
                class="form-control"
                [readonly]="!isEditing"
                [class.readonly]="!isEditing"
                placeholder="Enter account holder name">
            </div>
            
            <div class="form-group">
              <label>Account Number</label>
              <input 
                type="text" 
                [(ngModel)]="driverProfile.account_number"
                class="form-control"
                [readonly]="!isEditing"
                [class.readonly]="!isEditing"
                placeholder="Enter account number">
            </div>
          </div>
          
          <div class="form-row">
            <div class="form-group">
              <label>Bank Name</label>
              <input 
                type="text" 
                [(ngModel)]="driverProfile.bank_name"
                class="form-control"
                [readonly]="!isEditing"
                [class.readonly]="!isEditing"
                placeholder="Enter bank name">
            </div>
            
            <div class="form-group">
              <!-- Empty div for spacing -->
            </div>
          </div>
        </div>

        <!-- Edit Actions -->
        <div *ngIf="isEditing" class="edit-actions">
          <button 
            class="btn btn-success"
            (click)="saveProfile()"
            [disabled]="isSaving">
            <span *ngIf="isSaving" class="spinner"></span>
            {{ isSaving ? 'Saving...' : 'Save Changes' }}
          </button>
          <button 
            class="btn btn-secondary"
            (click)="cancelEdit()"
            [disabled]="isSaving">
            Cancel
          </button>
        </div>
      </div>
    </div>
  </div>
</div>
