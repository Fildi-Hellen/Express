<div class="container-fluid py-4">
  <!-- Header Section -->
  <div class="row mb-4">
    <div class="col-12 text-center">
      <h1 class="display-4 fw-bold text-primary mb-3">Book Your Ride</h1>
      <p class="lead text-muted">Fast, reliable, and affordable transportation at your fingertips</p>
    </div>
  </div>

  <!-- Main Content -->
  <div class="row">
    <!-- Left Side - Booking Form -->
    <div class="col-lg-6 mb-4">
      <div class="card shadow-lg border-0 h-100">
        <div class="card-header bg-primary text-white">
          <h4 class="card-title mb-0">
            <i class="fas fa-car me-2"></i>Book Your Ride
          </h4>
        </div>
        <div class="card-body p-4">
          <!-- Ride Type Selection -->
          <div class="mb-4">
            <label class="form-label fw-bold">Choose Ride Type</label>
            <div class="row g-2">
              <div class="col-4" *ngFor="let type of rideTypes">
                <input type="radio" 
                       class="btn-check" 
                       [id]="'rideType' + type.value" 
                       [(ngModel)]="rideForm.ride_type" 
                       [value]="type.value"
                       (change)="onRideTypeChange()">
                <label class="btn btn-outline-primary w-100 text-center py-3" 
                       [for]="'rideType' + type.value">
                  <div class="fs-3">{{type.icon}}</div>
                  <div class="fw-bold">{{type.label}}</div>
                  <small class="text-muted">Ã—{{type.multiplier}}</small>
                </label>
              </div>
            </div>
          </div>

          <!-- Pickup Location -->
          <div class="mb-3">
            <label class="form-label fw-bold">
              <i class="fas fa-map-marker-alt text-success me-2"></i>Pickup Location
            </label>
            <input type="text" 
                   class="form-control form-control-lg" 
                   [(ngModel)]="rideForm.pickup_location"
                   (input)="calculateEstimatedFare()"
                   placeholder="Enter pickup location"
                   list="pickupSuggestions">
            <datalist id="pickupSuggestions">
              <option *ngFor="let location of locationSuggestions" 
                      [value]="location.name"
                      (click)="selectLocation(location, 'pickup')">
                {{location.address}}
              </option>
            </datalist>
          </div>

          <!-- Destination -->
          <div class="mb-3">
            <label class="form-label fw-bold">
              <i class="fas fa-flag-checkered text-danger me-2"></i>Destination
            </label>
            <input type="text" 
                   class="form-control form-control-lg" 
                   [(ngModel)]="rideForm.destination"
                   (input)="calculateEstimatedFare()"
                   placeholder="Enter destination"
                   list="destinationSuggestions">
            <datalist id="destinationSuggestions">
              <option *ngFor="let location of locationSuggestions" 
                      [value]="location.name"
                      (click)="selectLocation(location, 'destination')">
                {{location.address}}
              </option>
            </datalist>
          </div>

          <!-- Passengers -->
          <div class="mb-3">
            <label class="form-label fw-bold">
              <i class="fas fa-users text-info me-2"></i>Number of Passengers
            </label>
            <select class="form-select form-select-lg" 
                    [(ngModel)]="rideForm.passengers"
                    (change)="calculateEstimatedFare()">
              <option *ngFor="let num of passengerOptions" [value]="num">
                {{num}} passenger{{num > 1 ? 's' : ''}}
              </option>
            </select>
          </div>

          <!-- Estimated Fare -->
          <div class="mb-4">
            <div class="card bg-light">
              <div class="card-body text-center">
                <h5 class="card-title text-primary">Estimated Fare</h5>
                <h3 class="card-text fw-bold text-success">
                  {{estimatedFare}} RWF
                </h3>
                <small class="text-muted">Final price may vary based on selected driver</small>
              </div>
            </div>
          </div>

          <!-- Search Button -->
          <button class="btn btn-primary btn-lg w-100 py-3" 
                  [disabled]="!isFormValid() || isLoading"
                  (click)="searchDrivers()">
            <span *ngIf="isLoading" class="spinner-border spinner-border-sm me-2"></span>
            <i *ngIf="!isLoading" class="fas fa-search me-2"></i>
            {{isLoading ? 'Searching...' : 'Find Drivers'}}
          </button>
        </div>
      </div>
    </div>

    <!-- Right Side - Process Steps or Driver List -->
    <div class="col-lg-6">
      <!-- Process Steps (shown when not searching for drivers) -->
      <div *ngIf="!showDrivers" class="card shadow-lg border-0 h-100">
        <div class="card-body p-4">
          <h4 class="card-title text-center mb-4">How It Works</h4>
          
          <ul class="list-unstyled">
            <li *ngFor="let step of steps; let i = index" class="d-flex mb-4">
              <div class="flex-shrink-0 me-3">
                <div class="bg-primary text-white rounded-circle d-flex align-items-center justify-content-center" 
                     style="width: 50px; height: 50px; font-weight: bold;">
                  {{i + 1}}
                </div>
              </div>
              <div class="flex-grow-1">
                <h5 class="fw-bold">{{step.title}}</h5>
                <p class="text-muted mb-0">{{step.description}}</p>
              </div>
            </li>
          </ul>

          <div class="text-center mt-4">
            <img [src]="imageSrc" 
                 alt="Ride Service" 
                 class="img-fluid rounded shadow"
                 style="max-height: 300px;">
          </div>
        </div>
      </div>

      <!-- Available Drivers List -->
      <div *ngIf="showDrivers" class="card shadow-lg border-0 h-100">
        <div class="card-header bg-success text-white d-flex justify-content-between align-items-center">
          <h4 class="card-title mb-0">
            <i class="fas fa-car me-2"></i>Available Drivers ({{availableDrivers.length}})
          </h4>
          <button class="btn btn-outline-light btn-sm" (click)="cancelSearch()">
            <i class="fas fa-times"></i> Cancel
          </button>
        </div>
        <div class="card-body p-0" style="max-height: 600px; overflow-y: auto;">
          <!-- Driver Cards -->
          <div *ngFor="let driver of availableDrivers; let i = index" 
               class="border-bottom p-3 driver-card"
               [class.selected]="selectedDriver?.id === driver.id"
               (click)="selectDriver(driver)"
               style="cursor: pointer;">
            <div class="row align-items-center">
              <!-- Driver Image -->
              <div class="col-3">
                <img [src]="driver.image" 
                     alt="Driver Photo" 
                     class="rounded-circle"
                     style="width: 60px; height: 60px; object-fit: cover;">
              </div>
              
              <!-- Driver Info -->
              <div class="col-6">
                <h6 class="mb-1 fw-bold">{{driver.name}}</h6>
                <div class="text-warning mb-1">
                  {{getStarRating(driver.rating)}} ({{driver.rating}})
                </div>
                <small class="text-muted">{{driver.vehicle_model}}</small>
                <br>
                <small class="text-muted">{{driver.license_plate}}</small>
              </div>
              
              <!-- Distance & Price -->
              <div class="col-3 text-end">
                <div class="fw-bold" [class]="getPriceClass(driver.price)">
                  {{driver.price}} RWF
                </div>
                <small class="text-muted">{{driver.distance}} km</small>
                <br>
                <small class="text-info">{{formatTime(driver.time)}}</small>
              </div>
            </div>
            
            <!-- Selection Indicator -->
            <div *ngIf="selectedDriver?.id === driver.id" 
                 class="mt-2 p-2 bg-success text-white rounded text-center">
              <i class="fas fa-check-circle me-2"></i>Selected
            </div>
          </div>

          <!-- Empty State -->
          <div *ngIf="availableDrivers.length === 0" class="text-center p-4">
            <i class="fas fa-car text-muted" style="font-size: 3rem;"></i>
            <h5 class="mt-3 text-muted">No drivers available</h5>
            <p class="text-muted">Please try again in a few minutes</p>
          </div>
        </div>
        
        <!-- Confirm Button -->
        <div *ngIf="selectedDriver" class="card-footer">
          <button class="btn btn-success btn-lg w-100" 
                  [disabled]="isLoading"
                  (click)="confirmRide()">
            <span *ngIf="isLoading" class="spinner-border spinner-border-sm me-2"></span>
            <i *ngIf="!isLoading" class="fas fa-check me-2"></i>
            {{isLoading ? 'Confirming...' : 'Confirm Ride with ' + selectedDriver.name}}
          </button>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Custom Styles -->
<style>
.driver-card:hover {
  background-color: #f8f9fa;
}

.driver-card.selected {
  background-color: #e8f5e8;
  border-left: 4px solid #198754;
}

.card {
  border-radius: 15px;
}

.btn-check:checked + .btn-outline-primary {
  background-color: #0d6efd;
  border-color: #0d6efd;
  color: white;
}

.form-control:focus,
.form-select:focus {
  border-color: #0d6efd;
  box-shadow: 0 0 0 0.25rem rgba(13, 110, 253, 0.25);
}

@media (max-width: 768px) {
  .container-fluid {
    padding: 1rem;
  }
  
  .card-body {
    padding: 1.5rem !important;
  }
}
</style>
